{% extends "base.html" %}

{% block title %}Manage Posts - CodeVault{% endblock %}

{% block head %}
<style>
    .post-management-grid {
        background: 
            linear-gradient(90deg, rgba(33, 150, 243, 0.05) 1px, transparent 1px),
            linear-gradient(rgba(33, 150, 243, 0.05) 1px, transparent 1px);
        background-size: 40px 40px;
    }

    .stats-card {
        background: linear-gradient(145deg, rgba(15, 23, 42, 0.9), rgba(25, 33, 52, 0.9));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(33, 150, 243, 0.2);
        transition: all 0.3s ease;
    }

    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 30px rgba(33, 150, 243, 0.3);
    }

    .post-table-container {
        background: linear-gradient(145deg, rgba(15, 23, 42, 0.9), rgba(25, 33, 52, 0.9));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(33, 150, 243, 0.2);
    }

    .table-header {
        background: linear-gradient(90deg, rgba(33, 150, 243, 0.2), rgba(182, 36, 255, 0.2));
    }

    .action-button {
        transition: all 0.3s ease;
    }

    .action-button:hover {
        filter: brightness(1.2);
        transform: translateY(-2px);
    }

    .search-input, .filter-select {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(33, 150, 243, 0.3);
        color: #e2e8f0;
        transition: all 0.3s ease;
    }

    .search-input:focus, .filter-select:focus {
        border-color: #2196f3;
        box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
    }

    .pagination-button {
        background: rgba(33, 150, 243, 0.1);
        border: 1px solid rgba(33, 150, 243, 0.3);
        color: #60a5fa;
        transition: all 0.3s ease;
    }

    .pagination-button:hover {
        background: rgba(33, 150, 243, 0.2);
        border-color: #2196f3;
    }

    .status-pill {
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-published {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .status-draft {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="post-management-grid min-h-screen py-8">
    <div class="container mx-auto px-4">
        <!-- Header -->
        <div class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-neon-blue to-neon-purple bg-clip-text text-transparent">
                    Manage Posts
                </h1>
                <p class="text-gray-400 mt-2">View, edit, and manage all blog posts</p>
            </div>
            <a href="{{ url_for('admin.admin_dashboard') }}" 
               class="px-4 py-2 rounded-lg border border-neon-blue/30 text-neon-blue hover:bg-neon-blue/10 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
            </a>
        </div>

        <!-- Filters and Search -->
        <div class="mb-6 flex flex-wrap gap-4 items-center">
            <form method="GET" class="flex flex-wrap gap-4 items-center">
                <select name="status" class="filter-select px-4 py-2 rounded-lg focus:outline-none">
                    <option value="">All Statuses</option>
                    <option value="published" {% if request.args.get('status') == 'published' %}selected{% endif %}>Published</option>
                    <option value="draft" {% if request.args.get('status') == 'draft' %}selected{% endif %}>Draft</option>
                </select>
                <select name="author" class="filter-select px-4 py-2 rounded-lg focus:outline-none">
                    <option value="">All Authors</option>
                    {% for author in authors %}
                    <option value="{{ author.id }}" {% if request.args.get('author')|int == author.id %}selected{% endif %}>{{ author.username }}</option>
                    {% endfor %}
                </select>
                <input type="text" 
                       name="search" 
                       value="{{ request.args.get('search', '') }}"
                       placeholder="Search posts..." 
                       class="search-input px-4 py-2 rounded-lg focus:outline-none">
                <button type="submit" 
                        class="px-4 py-2 bg-neon-blue text-white rounded-lg hover:bg-neon-blue/80 transition-colors">
                    Apply Filters
                </button>
            </form>
            <a href="{{ url_for('blog.create') }}" 
               class="ml-auto px-4 py-2 bg-neon-green text-cyber-dark rounded-lg hover:bg-neon-green/80 transition-colors">
                <i class="fas fa-plus mr-2"></i> New Post
            </a>
        </div>

        <!-- Posts Table -->
        <div class="post-table-container rounded-xl overflow-hidden">
            <table class="min-w-full divide-y divide-neon-blue/20">
                <thead class="table-header">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Title</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Author</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Created At</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-neon-blue/10">
                    {% for post in posts.items %}
                    <tr class="hover:bg-neon-blue/5">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-white">{{ post.title }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-300">{{ post.author.username }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="status-pill {{ 'status-published' if post.status == 'published' else 'status-draft' }}">
                                {{ post.status.capitalize() }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                            {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="{{ url_for('blog.post', post_id=post.id) }}" class="text-neon-blue hover:text-neon-purple mr-3">View</a>
                            <a href="{{ url_for('blog.edit', post_id=post.id) }}" class="text-neon-green hover:text-neon-green/80 mr-3">Edit</a>
                            <form action="{{ url_for('admin.delete_post', post_id=post.id) }}" method="POST" class="inline">
                                <button type="submit" class="text-red-500 hover:text-red-400" onclick="return confirm('Are you sure you want to delete this post?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if posts.pages > 1 %}
        <div class="mt-6 flex justify-center">
            <nav class="inline-flex rounded-md shadow">
                {% if posts.has_prev %}
                    <a href="{{ url_for('admin.manage_posts', page=posts.prev_num, **request.args) }}" class="pagination-button px-3 py-2 rounded-l-md">Previous</a>
                {% endif %}
                
                {% for page in posts.iter_pages() %}
                    {% if page %}
                        {% if page != posts.page %}
                            <a href="{{ url_for('admin.manage_posts', page=page, **request.args) }}" class="pagination-button px-3 py-2">{{ page }}</a>
                        {% else %}
                            <span class="px-3 py-2 bg-neon-blue text-white">{{ page }}</span>
                        {% endif %}
                    {% else %}
                        <span class="px-3 py-2 text-gray-500">...</span>
                    {% endif %}
                {% endfor %}
                
                {% if posts.has_next %}
                    <a href="{{ url_for('admin.manage_posts', page=posts.next_num, **request.args) }}" class="pagination-button px-3 py-2 rounded-r-md">Next</a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}